PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_all_table_info table_infos: 13
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
query_and_get_answer.router_id search_text: What is histamin?
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
query_and_get_answer.router_id Exception -
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 64, in query_and_get_answer
    router_id = int(self.router(search_text).answer)
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/primitives/program.py", line 26, in __call__
    return self.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/dspy_integration/router_prompt.py", line 54, in forward
    prediction = self.generate_answer(question=question)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/predict/predict.py", line 61, in __call__
    return self.forward(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/predict/chain_of_thought.py", line 59, in forward
    return super().forward(signature=signature, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/predict/predict.py", line 103, in forward
    x, C = dsp.generate(template, **config)(x, stage=self.stage)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/primitives/predict.py", line 77, in do_generate
    completions: list[dict[str, Any]] = generator(prompt, **kwargs)
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 182, in __call__
    response = self.request(prompt, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/backoff/_sync.py", line 105, in retry
    ret = target(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 148, in request
    return self.basic_request(prompt, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 121, in basic_request
    response = chat_request(**kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 269, in chat_request
    return v1_cached_gpt3_turbo_request_v2_wrapped(**kwargs).model_dump()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/cache_utils.py", line 16, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 262, in v1_cached_gpt3_turbo_request_v2_wrapped
    return v1_cached_gpt3_turbo_request_v2(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/joblib/memory.py", line 655, in __call__
    return self._cached_call(args, kwargs)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/joblib/memory.py", line 598, in _cached_call
    out, metadata = self.call(*args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/joblib/memory.py", line 856, in call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 256, in v1_cached_gpt3_turbo_request_v2
    return openai.chat.completions.create(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 181, in new_chat_completion
    raise e from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 177, in new_chat_completion
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/resources/chat/completions.py", line 667, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1213, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 902, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 993, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-mFPbi***************************************SA1O. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 46, in get_search_results
    search_result = await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 66, in query_and_get_answer
    logger.exception(
query_and_get_answer.router_id router_id: -1
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
call_brave_search_api Exception -
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 52, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 65, in call_brave_search_api
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
query_and_get_answer.router_id search_text: What is histamin?
HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
query_and_get_answer.router_id Exception -
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 64, in query_and_get_answer
    router_id = int(self.router(search_text).answer)
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/primitives/program.py", line 26, in __call__
    return self.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/dspy_integration/router_prompt.py", line 54, in forward
    prediction = self.generate_answer(question=question)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/predict/predict.py", line 61, in __call__
    return self.forward(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/predict/chain_of_thought.py", line 59, in forward
    return super().forward(signature=signature, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dspy/predict/predict.py", line 103, in forward
    x, C = dsp.generate(template, **config)(x, stage=self.stage)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/primitives/predict.py", line 77, in do_generate
    completions: list[dict[str, Any]] = generator(prompt, **kwargs)
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 182, in __call__
    response = self.request(prompt, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/backoff/_sync.py", line 105, in retry
    ret = target(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 148, in request
    return self.basic_request(prompt, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 121, in basic_request
    response = chat_request(**kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 269, in chat_request
    return v1_cached_gpt3_turbo_request_v2_wrapped(**kwargs).model_dump()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/cache_utils.py", line 16, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 262, in v1_cached_gpt3_turbo_request_v2_wrapped
    return v1_cached_gpt3_turbo_request_v2(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/joblib/memory.py", line 655, in __call__
    return self._cached_call(args, kwargs)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/joblib/memory.py", line 598, in _cached_call
    out, metadata = self.call(*args, **kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/joblib/memory.py", line 856, in call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/dsp/modules/gpt3.py", line 256, in v1_cached_gpt3_turbo_request_v2
    return openai.chat.completions.create(**kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 181, in new_chat_completion
    raise e from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 177, in new_chat_completion
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/resources/chat/completions.py", line 667, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1213, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 902, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 993, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-mFPbi***************************************SA1O. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 43, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 66, in query_and_get_answer
    logger.exception(
query_and_get_answer.router_id router_id: -1
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
call_brave_search_api Exception -
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 52, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 65, in call_brave_search_api
    logger.exception(
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 131, in query_and_get_answer
    extracted_pubmed_results, extracted_web_results = await asyncio.gather(
                                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 54, in _coro_creating_hub_and_span
    reraise(*_capture_exception(hub))
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/_compat.py", line 127, in reraise
    raise value
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
             ^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/pubmed/pubmedqueryengine.py", line 64, in call_pubmed_vectors
    raise ex
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/pubmed/pubmedqueryengine.py", line 60, in call_pubmed_vectors
    for n in self.retriever.retrieve(search_text)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/base_retriever.py", line 244, in retrieve
    nodes = self._retrieve(query_bundle)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/vector_store/retrievers/retriever.py", line 97, in _retrieve
    self._embed_model.get_agg_embedding_from_queries(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 178, in get_agg_embedding_from_queries
    query_embeddings = [self.get_query_embedding(query) for query in queries]
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 178, in <listcomp>
    query_embeddings = [self.get_query_embedding(query) for query in queries]
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 127, in get_query_embedding
    query_embedding = self._get_query_embedding(query)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/embeddings/text_embeddings_inference/base.py", line 112, in _get_query_embedding
    return self._call_api([query])[0]
           ~~~~~~~~~~~~~~~~~~~~~~~^^^
KeyError: 0
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 43, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
call_brave_search_api Exception -
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 52, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 65, in call_brave_search_api
    logger.exception(
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 131, in query_and_get_answer
    extracted_pubmed_results, extracted_web_results = await asyncio.gather(
                                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 54, in _coro_creating_hub_and_span
    reraise(*_capture_exception(hub))
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/_compat.py", line 127, in reraise
    raise value
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
             ^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/pubmed/pubmedqueryengine.py", line 64, in call_pubmed_vectors
    raise ex
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/pubmed/pubmedqueryengine.py", line 60, in call_pubmed_vectors
    for n in self.retriever.retrieve(search_text)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/base_retriever.py", line 244, in retrieve
    nodes = self._retrieve(query_bundle)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/vector_store/retrievers/retriever.py", line 97, in _retrieve
    self._embed_model.get_agg_embedding_from_queries(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 178, in get_agg_embedding_from_queries
    query_embeddings = [self.get_query_embedding(query) for query in queries]
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 178, in <listcomp>
    query_embeddings = [self.get_query_embedding(query) for query in queries]
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 127, in get_query_embedding
    query_embedding = self._get_query_embedding(query)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/embeddings/text_embeddings_inference/base.py", line 112, in _get_query_embedding
    return self._call_api([query])[0]
           ~~~~~~~~~~~~~~~~~~~~~~~^^^
KeyError: 0
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
call_brave_search_api Exception -
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 52, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 65, in call_brave_search_api
    logger.exception(
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 69, in map_httpcore_exceptions
    yield
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 233, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_sync/connection_pool.py", line 216, in handle_request
    raise exc from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_sync/connection_pool.py", line 196, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 99, in handle_request
    raise exc
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 76, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 122, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_backends/sync.py", line 205, in connect_tcp
    with map_exceptions(exc_map):
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 131, in query_and_get_answer
    extracted_pubmed_results, extracted_web_results = await asyncio.gather(
                                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 54, in _coro_creating_hub_and_span
    reraise(*_capture_exception(hub))
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/_compat.py", line 127, in reraise
    raise value
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
             ^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/pubmed/pubmedqueryengine.py", line 64, in call_pubmed_vectors
    raise ex
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/pubmed/pubmedqueryengine.py", line 60, in call_pubmed_vectors
    for n in self.retriever.retrieve(search_text)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/base_retriever.py", line 244, in retrieve
    nodes = self._retrieve(query_bundle)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/vector_store/retrievers/retriever.py", line 97, in _retrieve
    self._embed_model.get_agg_embedding_from_queries(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 178, in get_agg_embedding_from_queries
    query_embeddings = [self.get_query_embedding(query) for query in queries]
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 178, in <listcomp>
    query_embeddings = [self.get_query_embedding(query) for query in queries]
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/base/embeddings/base.py", line 127, in get_query_embedding
    query_embedding = self._get_query_embedding(query)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/embeddings/text_embeddings_inference/base.py", line 112, in _get_query_embedding
    return self._call_api([query])[0]
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/embeddings/text_embeddings_inference/base.py", line 79, in _call_api
    response = client.post(
               ^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_client.py", line 1145, in post
    return self.request(
           ^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_client.py", line 827, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/httpx.py", line 84, in send
    rv = real_send(self, request, **kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_client.py", line 1015, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 232, in handle_request
    with map_httpcore_exceptions():
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 86, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 61] Connection refused
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 51, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 64, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 142, in query_and_get_answer
    rerank_engine = TextEmbeddingInferenceRerankEngine(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/reranker/response_reranker.py", line 38, in __init__
    self.api = settings.api
    ^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/v1/main.py", line 357, in __setattr__
    raise ValueError(f'"{self.__class__.__name__}" object has no field "{name}"')
ValueError: "TextEmbeddingInferenceRerankEngine" object has no field "api"
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 51, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 64, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 142, in query_and_get_answer
    rerank_engine = TextEmbeddingInferenceRerankEngine(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/reranker/response_reranker.py", line 39, in __init__
    super().__init__(top_n=top_n, model=model)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/v1/main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 2 validation errors for TextEmbeddingInferenceRerankEngine
api
  field required (type=value_error.missing)
top_count
  field required (type=value_error.missing)
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 51, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 64, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 156, in query_and_get_answer
    result = summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 89, in get_response
    truncated_chunks = self._prompt_helper.truncate(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 255, in truncate
    text_splitter = self.get_text_splitter_given_prompt(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 234, in get_text_splitter_given_prompt
    chunk_size = self._get_available_chunk_size(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 219, in _get_available_chunk_size
    result = available_context_size // num_chunks - padding
             ~~~~~~~~~~~~~~~~~~~~~~~^^~~~~~~~~~~~
ZeroDivisionError: integer division or modulo by zero
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 53, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What%20is%20histamin?&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 66, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 156, in query_and_get_answer
    result = summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 89, in get_response
    truncated_chunks = self._prompt_helper.truncate(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 255, in truncate
    text_splitter = self.get_text_splitter_given_prompt(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 234, in get_text_splitter_given_prompt
    chunk_size = self._get_available_chunk_size(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 219, in _get_available_chunk_size
    result = available_context_size // num_chunks - padding
             ~~~~~~~~~~~~~~~~~~~~~~~^^~~~~~~~~~~~
ZeroDivisionError: integer division or modulo by zero
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
get_search_results. query: What+is+histamin
Orchestrator.query_and_get_answer.router_id search_text: What+is+histamin
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What+is+histamin
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What+is+histamin
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 53, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 66, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 156, in query_and_get_answer
    result = summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 89, in get_response
    truncated_chunks = self._prompt_helper.truncate(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 255, in truncate
    text_splitter = self.get_text_splitter_given_prompt(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 234, in get_text_splitter_given_prompt
    chunk_size = self._get_available_chunk_size(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 219, in _get_available_chunk_size
    result = available_context_size // num_chunks - padding
             ~~~~~~~~~~~~~~~~~~~~~~~^^~~~~~~~~~~~
ZeroDivisionError: integer division or modulo by zero
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
HTTP Request: GET http://localhost:6333/collections/pubmed_hybrid_vector_db "HTTP/1.1 404 Not Found"
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What+is+histamin
Orchestrator.query_and_get_answer.router_id search_text: What+is+histamin
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What+is+histamin
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What+is+histamin
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 53, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 66, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 156, in query_and_get_answer
    result = summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 89, in get_response
    truncated_chunks = self._prompt_helper.truncate(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 255, in truncate
    text_splitter = self.get_text_splitter_given_prompt(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 234, in get_text_splitter_given_prompt
    chunk_size = self._get_available_chunk_size(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/indices/prompt_helper.py", line 219, in _get_available_chunk_size
    result = available_context_size // num_chunks - padding
             ~~~~~~~~~~~~~~~~~~~~~~~^^~~~~~~~~~~~
ZeroDivisionError: integer division or modulo by zero
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What+is+histamin
Orchestrator.query_and_get_answer.router_id search_text: What+is+histamin
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What+is+histamin
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What+is+histamin
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 53, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 66, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What+is+histamin
Orchestrator.query_and_get_answer.router_id search_text: What+is+histamin
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What+is+histamin
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What+is+histamin
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAEYB0riePMZ2iBZmj26BA0v4RAKIH'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 53, in call_brave_search_api
    response.raise_for_status()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: https://api.search.brave.com/res/v1/web/search?count=10&q=What+is+histamin&search_lang=en&extra_snippets=True
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 66, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAhtjFNVIniAAhq-i93KT3kVV_4CDA'}
Brave search failed
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 57, in call_brave_search_api
    return [
           ^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 59, in <listcomp>
    text=resp.get("description") + resp.get("extra_snippets", ""),
         ~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
TypeError: can only concatenate str (not "list") to str
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/retrieval/web/brave_search.py", line 66, in call_brave_search_api
    logger.exception("Brave search failed", exc_info=e, stack_info=True)
Orchestrator.query_and_get_answer.extracted_results count: (0, 0)
PyTorch version 2.2.2 available.
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAhtjFNVIniAAhq-i93KT3kVV_4CDA'}
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.6319727783266471 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.9402734349507222 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 1.8358273605411721 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 6.304751809796477 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 6.698375138872489 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 159, in query_and_get_answer
    result = self.summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 97, in get_response
    response = self._llm.predict(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/llm.py", line 430, in predict
    chat_response = self.chat(messages)
                    ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai_like/base.py", line 106, in chat
    return super().chat(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/callbacks.py", line 144, in wrapped_llm_chat
    f_return_val = f(_self, messages, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 296, in chat
    return chat_fn(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 289, in wrapped_f
    return self(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 379, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 325, in iter
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 158, in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 382, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 362, in _chat
    response = client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 181, in new_chat_completion
    raise e from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 177, in new_chat_completion
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/resources/chat/completions.py", line 667, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1213, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 902, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 993, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 171, in query_and_get_answer
    logger.exception(
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAhtjFNVIniAAhq-i93KT3kVV_4CDA'}
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.5854713656375086 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 1.980240910448005 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 3.9067640184950663 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 5.323566018535881 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 5.854682462587942 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 159, in query_and_get_answer
    result = self.summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 97, in get_response
    response = self._llm.predict(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/llm.py", line 430, in predict
    chat_response = self.chat(messages)
                    ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai_like/base.py", line 106, in chat
    return super().chat(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/callbacks.py", line 144, in wrapped_llm_chat
    f_return_val = f(_self, messages, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 296, in chat
    return chat_fn(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 289, in wrapped_f
    return self(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 379, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 325, in iter
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 158, in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 382, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 362, in _chat
    response = client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 181, in new_chat_completion
    raise e from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 177, in new_chat_completion
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/resources/chat/completions.py", line 667, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1213, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 902, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 993, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 171, in query_and_get_answer
    logger.exception(
get_search_results. query: What is histamin?
Orchestrator.query_and_get_answer.router_id search_text: What is histamin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamin?&search_lang=en&extra_snippets=True
call_brave_search_api. headers: {'Accept': 'application/json', 'Accept-Encoding': 'gzip', 'X-Subscription-Token': 'BSAhtjFNVIniAAhq-i93KT3kVV_4CDA'}
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.2176916835624425 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 1.7845834695320069 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.018267626657010982 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 7.415169471831755 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 10.860318119133408 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 159, in query_and_get_answer
    result = self.summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 97, in get_response
    response = self._llm.predict(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/llm.py", line 430, in predict
    chat_response = self.chat(messages)
                    ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai_like/base.py", line 106, in chat
    return super().chat(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/callbacks.py", line 144, in wrapped_llm_chat
    f_return_val = f(_self, messages, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 296, in chat
    return chat_fn(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 289, in wrapped_f
    return self(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 379, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 325, in iter
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 158, in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 382, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 362, in _chat
    response = client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 181, in new_chat_completion
    raise e from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 177, in new_chat_completion
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/resources/chat/completions.py", line 667, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1213, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 902, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 993, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 171, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
get_search_results. query: What is histamin?
get_search_results. query: What is histamin?
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is histamin?
get_search_results. result: result='Some result' sources=['source 1', 'source 2']
get_search_results. query: What is histamin?
get_search_results. query: What is histamin?
get_search_results. query: What is histamin?
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is histamin?
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.49677518206167504 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 1.0233787974377828 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 0.07355576258260621 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 2.812692963438522 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Retrying llama_index.llms.openai.base.OpenAI._chat in 7.182616875626088 seconds as it raised AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}.
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 401 Unauthorized"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 159, in query_and_get_answer
    result = self.summarizer.get_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/response_synthesizers/simple_summarize.py", line 97, in get_response
    response = self._llm.predict(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/instrumentation/dispatcher.py", line 211, in wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/llm.py", line 430, in predict
    chat_response = self.chat(messages)
                    ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai_like/base.py", line 106, in chat
    return super().chat(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/llms/callbacks.py", line 144, in wrapped_llm_chat
    f_return_val = f(_self, messages, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 296, in chat
    return chat_fn(messages, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 289, in wrapped_f
    return self(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 379, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 325, in iter
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 158, in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/tenacity/__init__.py", line 382, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/llms/openai/base.py", line 362, in _chat
    response = client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 181, in new_chat_completion
    raise e from None
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/openai.py", line 177, in new_chat_completion
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_utils/_utils.py", line 275, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/resources/chat/completions.py", line 667, in create
    return self._post(
           ^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1213, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 902, in request
    return self._request(
           ^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 993, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API key provided. You can find your API key at https://api.together.xyz/settings/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 171, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is histamine?
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 170, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 5 validation errors for SearchResultRecord
sources.0
  Input should be a valid string [type=string_type, input_value={'url': 'https://www.news...: '2019-02-26T00:00:00'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.1
  Input should be a valid string [type=string_type, input_value={'url': 'https://www.ncbi...: '2023-05-01T00:00:00'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.2
  Input should be a valid string [type=string_type, input_value={'url': 'https://en.wikip...: '2024-04-01T03:53:30'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.3
  Input should be a valid string [type=string_type, input_value={'url': 'https://www.brit...: '2023-07-26T00:00:00'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.4
  Input should be a valid string [type=string_type, input_value={'url': 'https://www.heal...: '2023-10-02T06:05:10'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 173, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 171, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SearchResultRecord
sources
  Input should be a valid dictionary [type=dict_type, input_value=[{'url': 'https://www.new... '2023-10-02T06:05:10'}], input_type=list]
    For further information visit https://errors.pydantic.dev/2.6/v/dict_type
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 174, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
[{'url': 'https://www.news-medical.net/health/What-is-Histamine.aspx', 'page_age': '2019-02-26T00:00:00'}, {'url': 'https://www.ncbi.nlm.nih.gov/books/NBK557790/', 'page_age': '2023-05-01T00:00:00'}, {'url': 'https://en.wikipedia.org/wiki/Histamine', 'page_age': '2024-04-01T03:53:30'}, {'url': 'https://www.britannica.com/science/histamine', 'page_age': '2023-07-26T00:00:00'}, {'url': 'https://www.healthline.com/health/allergies/what-is-histamine', 'page_age': '2023-10-02T06:05:10'}]
NoneType: None
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 176, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SearchResultRecord
sources
  Input should be a valid dictionary [type=dict_type, input_value=[{'url': 'https://www.new... '2023-10-02T06:05:10'}], input_type=list]
    For further information visit https://errors.pydantic.dev/2.6/v/dict_type
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 179, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
[{'url': 'https://www.news-medical.net/health/What-is-Histamine.aspx', 'page_age': '2019-02-26T00:00:00'}, {'url': 'https://www.ncbi.nlm.nih.gov/books/NBK557790/', 'page_age': '2023-05-01T00:00:00'}, {'url': 'https://en.wikipedia.org/wiki/Histamine', 'page_age': '2024-04-01T03:53:30'}, {'url': 'https://www.britannica.com/science/histamine', 'page_age': '2023-07-26T00:00:00'}, {'url': 'https://www.healthline.com/health/allergies/what-is-histamine', 'page_age': '2023-10-02T06:05:10'}]
NoneType: None
get_search_results. result: result=' Histamine is an organic nitrogenous compound that plays a key role in the inflammatory response of the body. It is involved in local immune responses communication and regulates physiological functions in the gut. Additionally, it acts as a neurotransmitter for the brain, spinal cord, and uterus. Histamine is synthesized from L-histidine exclusively by L-histidine decarboxylase and is present within all bodily tissues, with its highest concentration in the lungs, basophils, and mast cells. It is also a potent vasoactive agent, affecting bronchial smooth muscles and nociceptive itch nerves. Histamine regulates a variety of physiological functions and has a vital role in various pathomechanisms of inflammatory diseases. Two major pathways metabolize most (>97%) of the synthesized histamine: histamine-N-methyltransferase (50 to 80%) and diamine oxidase (15 to 30%).' sources=[{'url': 'https://www.news-medical.net/health/What-is-Histamine.aspx', 'page_age': '2019-02-26T00:00:00'}, {'url': 'https://www.ncbi.nlm.nih.gov/books/NBK557790/', 'page_age': '2023-05-01T00:00:00'}, {'url': 'https://en.wikipedia.org/wiki/Histamine', 'page_age': '2024-04-01T03:53:30'}, {'url': 'https://www.britannica.com/science/histamine', 'page_age': '2023-07-26T00:00:00'}, {'url': 'https://www.healthline.com/health/allergies/what-is-histamine', 'page_age': '2023-10-02T06:05:10'}]
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 793, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 496, in _make_request
    conn.request(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 400, in request
    self.endheaders()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/http/client.py", line 1293, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/http/client.py", line 1052, in _send_output
    self.send(msg)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/http/client.py", line 990, in send
    self.connect()
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 238, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 213, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x289eaaa50>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 847, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/urllib3/util/retry.py", line 515, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /rerank (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x289eaaa50>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    reranked_results = self.rerank_engine.postprocess_nodes(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/postprocessor/types.py", line 55, in postprocess_nodes
    return self._postprocess_nodes(nodes, query_bundle)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/reranker/response_reranker.py", line 79, in _postprocess_nodes
    results = self._session.post(  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/sessions.py", line 637, in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /rerank (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x289eaaa50>: Failed to establish a new connection: [Errno 61] Connection refused'))
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 183, in query_and_get_answer
    logger.exception(
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    reranked_results = self.rerank_engine.postprocess_nodes(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/postprocessor/types.py", line 55, in postprocess_nodes
    return self._postprocess_nodes(nodes, query_bundle)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/reranker/response_reranker.py", line 94, in _postprocess_nodes
    node=nodes[result["index"]], score=result["score"]
               ~~~~~~^^^^^^^^^
TypeError: string indices must be integers, not 'str'
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 183, in query_and_get_answer
    logger.exception(
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 424 Failed Dependency"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 167, in query_and_get_answer
    reranked_results = self.rerank_engine.postprocess_nodes(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/llama_index/core/postprocessor/types.py", line 55, in postprocess_nodes
    return self._postprocess_nodes(nodes, query_bundle)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/rag/reranker/response_reranker.py", line 94, in _postprocess_nodes
    node=nodes[result["index"]], score=result["score"]
               ~~~~~~^^^^^^^^^
TypeError: string indices must be integers, not 'str'
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 183, in query_and_get_answer
    logger.exception(
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 180, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 8 validation errors for SearchResultRecord
sources.0.dict[str,str].page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.0.BraveSourceRecord.page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.2.dict[str,str].page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.2.BraveSourceRecord.page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.3.dict[str,str].page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.3.BraveSourceRecord.page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.4.dict[str,str].page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
sources.4.BraveSourceRecord.page_age
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.6/v/string_type
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 183, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class. It has a specific atomic structure, with its empirical formula being C17H18FN3O3 and a molecular weight of 331.35 g/mol. It is a faintly yellowish to light yellow crystalline substance. Ciprofloxacin hydrochloride, a form of Ciprofloxacin, is the monohydrochloride monohydrate salt of ciprofloxacin and has a molecular weight of 385.8 g/mol. Its empirical formula is C17H18FN3O3HClH2O.' sources=[{'url': 'https://proteopedia.org/wiki/index.php/Ciprofloxacin', 'page_age': None}, {'url': 'https://en.wikipedia.org/wiki/Ciprofloxacin', 'page_age': '2024-03-13T14:52:39'}, {'url': 'https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', 'page_age': None}, {'url': 'https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', 'page_age': None}, {'url': 'https://www.drugs.com/ciprofloxacin.html', 'page_age': None}]
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
get_search_results. query: What is the molecular type of Ciprofloxacin
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class. It is a broad-range antibiotic that is used to treat a wide range of infections, including inhalational anthrax. Its molecular formula is C17H18FN3O3 and it has a molecular weight of 331.35 g/mol. It is a faintly yellowish to light yellow crystalline substance. It is a potent suppressor of bacterial DNA gyrase and creates a complex structure with the enzyme and cleaved DNA that is covalently joined to the GyrA subunits.' sources=[{'url': 'https://proteopedia.org/wiki/index.php/Ciprofloxacin', 'page_age': None}, {'url': 'https://en.wikipedia.org/wiki/Ciprofloxacin', 'page_age': '2024-03-13T14:52:39'}, {'url': 'https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', 'page_age': None}, {'url': 'https://go.drugbank.com/drugs/DB00537', 'page_age': None}, {'url': 'https://www.drugs.com/ciprofloxacin.html', 'page_age': None}]
PyTorch version 2.2.2 available.
get_search_results. query: test
Orchestrator.query_and_get_answer.router_id search_text: test
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: test
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: test
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=test&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: test
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' To test something means to try it, for example, by touching it or using it for a short time, in order to find out what it is, what condition it is in, or how well it works. It can also refer to a deliberate action or experiment to find out how well something works. Additionally, a test can be a series of questions or exercises for measuring the skill, knowledge, intelligence, capacities, or aptitudes of an individual or group.' sources=[{'url': 'https://www.dictionary.com/browse/test', 'page_age': None}, {'url': 'https://en.wikipedia.org/wiki/Test', 'page_age': '2024-01-06T23:30:07'}, {'url': 'https://dictionary.cambridge.org/us/dictionary/english/test', 'page_age': '2023-08-02T18:45:02'}, {'url': 'https://www.collinsdictionary.com/us/dictionary/english/test', 'page_age': '2020-11-11T01:30:08'}, {'url': 'https://www.merriam-webster.com/dictionary/test', 'page_age': '2023-08-12T06:20:04'}]
get_search_results. query: test
get_search_results. query: test
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: test
get_search_results. query: test
get_search_results. query: test
get_search_results. query: test
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' The molecular formula of ciprofloxacin is C17H18FN3O3.' sources=[{'url': 'https://en.wikipedia.org/wiki/Ciprofloxacin', 'page_age': '2024-03-13T14:52:39'}, {'url': 'https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', 'page_age': None}, {'url': 'https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', 'page_age': None}, {'url': 'https://www.drugs.com/ciprofloxacin.html', 'page_age': None}, {'url': 'https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin-hydrochloride', 'page_age': None}]
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
get_search_results. query: What is the molecular type of Ciprofloxacin?
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
get_search_results. query: What is the molecular type of Ciprofloxacin?
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What is the molecular type of Ciprofloxacin?
get_search_results. query: What is the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class. It has an empirical formula of C17H18FN3O3 and a molecular weight of 331.4 g/mol. It is a faintly yellowish to light yellow crystalline substance and is the monohydrochloride monohydrate salt of ciprofloxacin, with a molecular weight of 385.8 g/mol and an empirical formula of C17H18FN3O3HClH2O.' sources=[{'url': 'https://proteopedia.org/wiki/index.php/Ciprofloxacin', 'page_age': None}, {'url': 'https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', 'page_age': None}, {'url': 'https://en.wikipedia.org/wiki/Ciprofloxacin', 'page_age': '2024-03-13T14:52:39'}, {'url': 'https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', 'page_age': None}, {'url': 'https://go.drugbank.com/drugs/DB00537', 'page_age': None}]
get_search_results. query: What is the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class. It has an empirical formula of C17H18FN3O3 and a molecular weight of 331.4 g/mol. It is a faintly yellowish to light yellow crystalline substance and is the monohydrochloride monohydrate salt of ciprofloxacin, with a molecular weight of 385.8 g/mol and an empirical formula of C17H18FN3O3HClH2O.' sources=[{'url': 'https://proteopedia.org/wiki/index.php/Ciprofloxacin', 'page_age': None}, {'url': 'https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', 'page_age': None}, {'url': 'https://en.wikipedia.org/wiki/Ciprofloxacin', 'page_age': '2024-03-13T14:52:39'}, {'url': 'https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', 'page_age': None}, {'url': 'https://go.drugbank.com/drugs/DB00537', 'page_age': None}]
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 185, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 10 validation errors for SearchResultRecord
sources.0.origin
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.0.metadata
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.origin
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.metadata
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.origin
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.metadata
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.origin
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.metadata
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.origin
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.metadata
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 188, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 185, in query_and_get_answer
    result = SearchResultRecord(result=result, sources=sources)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 10 validation errors for SearchResultRecord
sources.0.origin
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.0.metadata
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.origin
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.metadata
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.origin
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.metadata
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.origin
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.metadata
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.origin
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.metadata
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 190, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class.' sources=[BraveSourceRecord(url='https://proteopedia.org/wiki/index.php/Ciprofloxacin', page_age=None), BraveSourceRecord(url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(url='https://go.drugbank.com/drugs/DB00537', page_age=None)]
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 191, in query_and_get_answer
    result = SearchResultRecord(result=result, sources=sources)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 20 validation errors for SearchResultRecord
sources.0.BraveSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.0.OtherSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.0.OtherSourceRecord.origin
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.0.OtherSourceRecord.metadata
  Field required [type=missing, input_value={'url': 'https://proteope...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.BraveSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.OtherSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.OtherSourceRecord.origin
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.1.OtherSourceRecord.metadata
  Field required [type=missing, input_value={'url': 'https://en.wikip...: '2024-03-13T14:52:39'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.BraveSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.OtherSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.OtherSourceRecord.origin
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.2.OtherSourceRecord.metadata
  Field required [type=missing, input_value={'url': 'https://www.scie...acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.BraveSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.OtherSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.OtherSourceRecord.origin
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.3.OtherSourceRecord.metadata
  Field required [type=missing, input_value={'url': 'https://pubchem....acin', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.BraveSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.OtherSourceRecord.type
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.OtherSourceRecord.origin
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
sources.4.OtherSourceRecord.metadata
  Field required [type=missing, input_value={'url': 'https://go.drugb...0537', 'page_age': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.6/v/missing
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 257, in _sentry_exceptionmiddleware_call
    await old_call(self, scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/starlette.py", line 158, in _create_span_call
    return await old_call(app, scope, new_receive, new_send, **kwargs)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 758, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 778, in app
    await route.handle(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 299, in handle
    await self.app(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 79, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/starlette/routing.py", line 74, in app
    response = await func(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/router/gzip.py", line 30, in custom_route_handler
    return await original_route_handler(request)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/endpoints/search_endpoint.py", line 44, in get_search_results
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 196, in query_and_get_answer
    logger.exception(
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class.' sources=[BraveSourceRecord(type='brave', url='https://proteopedia.org/wiki/index.php/Ciprofloxacin', page_age=None), BraveSourceRecord(type='brave', url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(type='brave', url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(type='brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(type='brave', url='https://go.drugbank.com/drugs/DB00537', page_age=None)]
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class.' sources=[BraveSourceRecord(type='Brave', url='https://proteopedia.org/wiki/index.php/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(type='Brave', url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://go.drugbank.com/drugs/DB00537', page_age=None)]
get_search_results. query: What's the molecular type of Ciprofloxacin?
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Ciprofloxacin is a synthetic antimicrobial agent of the fluoroquinolone class.' sources=[BraveSourceRecord(type='Brave', url='https://proteopedia.org/wiki/index.php/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(type='Brave', url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://go.drugbank.com/drugs/DB00537', page_age=None)]
PyTorch version 2.2.2 available.
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' The molecular formula of ciprofloxacin is C17H18FN3O3.' sources=[BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(type='Brave', url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://go.drugbank.com/drugs/DB00537', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin-hydrochloride', page_age=None)]
get_search_results. query: test
Orchestrator.query_and_get_answer.router_id search_text: test
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: test
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: test
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=test&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: test
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' To test something means to try it, for example, by touching it or using it for a short time, in order to find out what it is, what condition it is in, or how well it works. It can also refer to a deliberate action or experiment to find out how well something works. Additionally, a test can be a series of questions or exercises for measuring the skill, knowledge, intelligence, capacities, or aptitudes of an individual or group.' sources=[BraveSourceRecord(type='Brave', url='https://www.dictionary.com/browse/test', page_age=None), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Test', page_age='2024-01-06T23:30:07'), BraveSourceRecord(type='Brave', url='https://dictionary.cambridge.org/us/dictionary/english/test', page_age='2023-08-02T18:45:02'), BraveSourceRecord(type='Brave', url='https://www.collinsdictionary.com/us/dictionary/english/test', page_age='2020-11-11T01:30:08'), BraveSourceRecord(type='Brave', url='https://www.merriam-webster.com/dictionary/test', page_age='2023-08-12T06:20:04')]
get_search_results. query: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What's the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What's the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What's the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What's the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' The molecular formula of ciprofloxacin is C17H18FN3O3.' sources=[BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(type='Brave', url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://go.drugbank.com/drugs/DB00537', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin-hydrochloride', page_age=None)]
get_search_results. query: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id search_text: What is the molecular type of Ciprofloxacin?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is the molecular type of Ciprofloxacin?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is the molecular type of Ciprofloxacin?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is the molecular type of Ciprofloxacin?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' The molecular formula of ciprofloxacin is C17H18FN3O3.' sources=[BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Ciprofloxacin', page_age='2024-03-13T14:52:39'), BraveSourceRecord(type='Brave', url='https://www.sciencedirect.com/topics/chemistry/ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin', page_age=None), BraveSourceRecord(type='Brave', url='https://www.drugs.com/ciprofloxacin.html', page_age=None), BraveSourceRecord(type='Brave', url='https://pubchem.ncbi.nlm.nih.gov/compound/Ciprofloxacin-hydrochloride', page_age=None)]
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Histamine is an organic nitrogenous compound that is involved in local immune responses communication, as well as regulating physiological functions in the gut and acting as a neurotransmitter for the brain, spinal cord, and uterus. It is synthesized from L-histidine exclusively by L-histidine decarboxylase and is present within all bodily tissues, with its sites of highest concentration being the lungs, basophils, and mast cells. Histamine is a potent vasoactive agent and plays a key role in the inflammatory response of the body. It is also involved in various pathomechanisms of inflammatory diseases and has been recognized as a central neurotransmitter in recent years. Histamine is metabolized by two major pathways: histamine-N-methyltransferase and diamine oxidase, with only 2 to 3% being excreted unchanged. It is an important part of the allergic response, and people use antihistamines to treat allergy symptoms caused by having too much histamine in their bodies. Histamine is also involved in various bodily functions that can affect the gastrointestinal (GI) tract, brain, and overall immune response.' sources=[BraveSourceRecord(type='Brave', url='https://www.ncbi.nlm.nih.gov/books/NBK557790/', page_age='2023-05-01T00:00:00'), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Histamine', page_age='2024-04-01T03:53:30'), BraveSourceRecord(type='Brave', url='https://www.britannica.com/science/histamine', page_age='2023-07-26T00:00:00'), BraveSourceRecord(type='Brave', url='https://www.healthline.com/health/allergies/what-is-histamine', page_age='2023-10-02T06:05:10'), BraveSourceRecord(type='Brave', url='https://www.webmd.com/diet/foods-high-in-histamine', page_age='2022-10-19T00:00:00')]
get_search_results. query: What is histamine?
Orchestrator.query_and_get_answer.router_id search_text: What is histamine?
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: What is histamine?
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: What is histamine?
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=What is histamine?&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: What is histamine?
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' Histamine is an organic nitrogenous compound that is widely distributed throughout the animal kingdom and is present in many plants and bacteria, as well as in insect venom. In humans, it is found in nearly all tissues, where it is stored mainly in mast cells. Histamine is synthesized from the amino acid histidine by the enzyme histidine decarboxylase and is metabolized primarily by the enzymes histamine-N-methyltransferase and diamine oxidase. It is involved in local immune responses, regulating physiological functions in the gut, and acting as a neurotransmitter for the brain, spinal cord, and uterus. Histamine is also a potent vasoactive agent and plays a key role in the inflammatory response of the body. It is released by white blood cells into the bloodstream when the immune system is defending against a potential allergen, which can result in an allergic reaction.' sources=[BraveSourceRecord(type='Brave', url='https://www.ncbi.nlm.nih.gov/books/NBK557790/', page_age='2023-05-01T00:00:00'), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Histamine', page_age='2024-04-01T03:53:30'), BraveSourceRecord(type='Brave', url='https://www.britannica.com/science/histamine', page_age='2023-07-26T00:00:00'), BraveSourceRecord(type='Brave', url='https://www.healthline.com/health/allergies/what-is-histamine', page_age='2023-10-02T06:05:10'), BraveSourceRecord(type='Brave', url='https://www.webmd.com/diet/foods-high-in-histamine', page_age='2022-10-19T00:00:00')]
get_search_results. query: test
Orchestrator.query_and_get_answer.router_id search_text: test
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: test
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: test
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=test&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: test
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' To test something means to try it, for example, by touching it or using it for a short time, in order to find out what it is, what condition it is in, or how well it works. It can also refer to a deliberate action or experiment to find out how well something works. Additionally, a test can be a series of questions or exercises for measuring the skill, knowledge, intelligence, capacities, or aptitudes of an individual or group.' sources=[BraveSourceRecord(type='Brave', url='https://www.dictionary.com/browse/test', page_age=None), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Test', page_age='2024-01-06T23:30:07'), BraveSourceRecord(type='Brave', url='https://dictionary.cambridge.org/us/dictionary/english/test', page_age='2023-08-02T18:45:02'), BraveSourceRecord(type='Brave', url='https://www.collinsdictionary.com/us/dictionary/english/test', page_age='2020-11-11T01:30:08'), BraveSourceRecord(type='Brave', url='https://www.merriam-webster.com/dictionary/test', page_age='2023-08-12T06:20:04')]
get_search_results. query: test
Orchestrator.query_and_get_answer.router_id search_text: test
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: test
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: test
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=test&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: test
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
get_search_results. result: result=' To test something means to try it, for example, by touching it or using it for a short time, in order to find out what it is, what condition it is in, or how well it works. It can also refer to a deliberate action or experiment to find out how well something works. Additionally, a test can be a series of questions or exercises for measuring the skill, knowledge, intelligence, capacities, or aptitudes of an individual or group.' sources=[BraveSourceRecord(type='Brave', url='https://www.dictionary.com/browse/test', page_age=None), BraveSourceRecord(type='Brave', url='https://en.wikipedia.org/wiki/Test', page_age='2024-01-06T23:30:07'), BraveSourceRecord(type='Brave', url='https://dictionary.cambridge.org/us/dictionary/english/test', page_age='2023-08-02T18:45:02'), BraveSourceRecord(type='Brave', url='https://www.collinsdictionary.com/us/dictionary/english/test', page_age='2020-11-11T01:30:08'), BraveSourceRecord(type='Brave', url='https://www.merriam-webster.com/dictionary/test', page_age='2023-08-12T06:20:04')]
PyTorch version 2.2.2 available.
Server started on port: 50051
get_search_results. query: test
Orchestrator.query_and_get_answer.router_id search_text: test
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: test
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: test
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=test&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: test
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 196, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
TypeError: Can't instantiate abstract class SourceRecord with abstract method to_grpc_source
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1204, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1176, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1147, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/main.py", line 72, in <module>
    app = start_server()
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/main.py", line 66, in start_server
    loop.run_until_complete(serve())
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/grpc/aio/server.py", line 54, in wrapped
    return await handler.unary_unary(request, context)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/search.py", line 29, in search
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 199, in query_and_get_answer
    logger.exception(
get_search_results. failed to get the search results
get_search_results. query: test
Orchestrator.query_and_get_answer.router_id search_text: test
Orchestrator.query_and_get_answer.router_id Fallback Entered.
PubmedSearchQueryEngine.call_pubmed_vectors query: test
HTTP Request: POST http://127.0.0.1:8080/embed "HTTP/1.1 200 OK"
call_brave_search_api. query: test
call_brave_search_api. endpoint: https://api.search.brave.com/res/v1/web/search?count=10&q=test&search_lang=en&extra_snippets=True
Orchestrator.query_and_get_answer.extracted_results count: (0, 10)
TextEmbeddingInferenceRerankEngine.postprocess_nodes query: test
HTTP Request: POST https://api.together.xyz/v1/chat/completions "HTTP/1.1 200 OK"
Orchestrator.query_and_get_answer.fallback failed: 
Traceback (most recent call last):
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 196, in query_and_get_answer
    return SearchResultRecord(result=result, sources=sources)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/pydantic/main.py", line 171, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
TypeError: Can't instantiate abstract class SourceRecord with abstract method to_grpc_source
Stack (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1204, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1176, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1147, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/main.py", line 72, in <module>
    app = start_server()
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/main.py", line 66, in start_server
    loop.run_until_complete(serve())
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
    self._run_once()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
    handle._run()
  File "/Users/ivarflakstad/.pyenv/versions/3.11.8/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/asyncio.py", line 52, in _coro_creating_hub_and_span
    result = await coro
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/grpc/aio/server.py", line 54, in wrapped
    return await handler.unary_unary(request, context)
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/api/search.py", line 29, in search
    if search_result := await orchestrator.query_and_get_answer(
  File "/Users/ivarflakstad/dev/curieo/search/backend/app/router/orchestrator.py", line 199, in query_and_get_answer
    logger.exception(
get_search_results. failed to get the search results
Unexpected [AttributeError] raised by servicer method [/agency.AgencyService/pubmed_bioxriv_web_search]
Traceback (most recent call last):
  File "src/python/grpcio/grpc/_cython/_cygrpc/aio/server.pyx.pxi", line 689, in grpc._cython.cygrpc._handle_exceptions
  File "src/python/grpcio/grpc/_cython/_cygrpc/aio/server.pyx.pxi", line 789, in _handle_rpc
  File "src/python/grpcio/grpc/_cython/_cygrpc/aio/server.pyx.pxi", line 383, in _find_method_handler
  File "src/python/grpcio/grpc/_cython/_cygrpc/aio/server.pyx.pxi", line 360, in _run_interceptor
  File "/Users/ivarflakstad/dev/curieo/search/backend/.venv/lib/python3.11/site-packages/sentry_sdk/integrations/grpc/aio/server.py", line 33, in intercept_service
    if not handler.request_streaming and not handler.response_streaming:
           ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'request_streaming'
